{% extends "base.html" %}

{% block title %}RATE LECTURES - FaceLogged Cyber System{% endblock %}

{% block content %}
<style>
    .rating-container {
        max-width: 1000px;
        margin: 0 auto;
    }
    
    .session-card {
        background: rgba(17, 17, 34, 0.8);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(0, 243, 255, 0.2);
        border-radius: 12px;
        padding: 2rem;
        margin-bottom: 1.5rem;
        transition: all 0.3s ease;
    }
    
    .session-card:hover {
        border-color: var(--cyber-blue);
        box-shadow: 0 8px 25px rgba(0, 243, 255, 0.2);
        transform: translateY(-2px);
    }
    
    .session-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid rgba(0, 243, 255, 0.2);
    }
    
    .session-info {
        flex-grow: 1;
    }
    
    .session-title {
        font-family: 'Orbitron', monospace;
        font-size: 1.3rem;
        color: var(--cyber-blue);
        margin-bottom: 0.5rem;
    }
    
    .session-meta {
        display: flex;
        gap: 2rem;
        font-family: 'Exo 2', sans-serif;
        color: var(--text-light);
    }
    
    .meta-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .rating-section {
        background: rgba(0, 243, 255, 0.05);
        border: 1px solid rgba(0, 243, 255, 0.2);
        border-radius: 8px;
        padding: 1.5rem;
    }
    
    .rating-stars-cyber {
        font-size: 2rem;
        margin-bottom: 1rem;
    }
    
    .star-cyber {
        cursor: pointer;
        transition: all 0.2s ease;
        margin: 0 0.2rem;
    }
    
    .star-cyber:hover {
        transform: scale(1.2);
    }
    
    .star-active {
        color: #ffd700;
    }
    
    .star-inactive {
        color: rgba(255, 255, 255, 0.3);
    }
    
    .feedback-input {
        background: rgba(0, 243, 255, 0.05);
        border: 1px solid rgba(0, 243, 255, 0.3);
        border-radius: 8px;
        color: var(--text-light);
        padding: 1rem;
        font-family: 'Exo 2', sans-serif;
        resize: vertical;
        min-height: 100px;
        transition: all 0.3s ease;
    }
    
    .feedback-input:focus {
        background: rgba(0, 243, 255, 0.1);
        border-color: var(--cyber-blue);
        box-shadow: 0 0 0 0.2rem rgba(0, 243, 255, 0.25);
        color: var(--text-light);
    }
    
    .btn-submit-rating {
        background: linear-gradient(135deg, var(--cyber-blue), var(--cyber-purple));
        border: none;
        border-radius: 8px;
        padding: 0.75rem 2rem;
        font-family: 'Orbitron', monospace;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 1px;
        color: var(--dark-bg);
        transition: all 0.3s ease;
    }
    
    .btn-submit-rating:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0, 243, 255, 0.4);
        color: var(--dark-bg);
    }
    
    .empty-state-rating {
        text-align: center;
        padding: 4rem 2rem;
    }
    
    .empty-icon-rating {
        width: 120px;
        height: 120px;
        background: rgba(0, 243, 255, 0.1);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 2rem;
        font-size: 3rem;
        color: var(--cyber-blue);
    }
</style>

<div class="page-header">
    <h1 class="page-title">RATE LECTURES</h1>
    <div class="page-subtitle">PROVIDE FEEDBACK ON YOUR LEARNING EXPERIENCE</div>
</div>

<div class="rating-container">
    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show mb-4" role="alert">
                    <i class="fas fa-{% if category == 'success' %}check-circle{% elif category == 'warning' %}exclamation-triangle{% elif category == 'danger' %}exclamation-circle{% else %}info-circle{% endif %} me-2"></i>
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" style="filter: invert(1);"></button>
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    {% if sessions_to_rate %}
    <div class="ratings-card">
        <div class="card-body">
            <h4 class="cyber-text mb-4">
                <i class="fas fa-list me-2"></i>LECTURES AWAITING FEEDBACK
            </h4>
            <p class="text-light mb-4">Please provide your feedback for the following lectures you have attended:</p>
            
            {% for session in sessions_to_rate %}
            <div class="session-card">
                <div class="session-header">
                    <div class="session-info">
                        <div class="session-title">{{ session[1] }} - {{ session[2] }}</div>
                        <div class="session-meta">
                            <div class="meta-item">
                                <i class="fas fa-calendar text-cyber"></i>
                                <span>{{ session[3] }} {% if session[5] %}at {{ session[5] }}{% endif %}</span>
                            </div>
                            <div class="meta-item">
                                <i class="fas fa-book text-cyber"></i>
                                <span>{{ session[4] or 'General Lecture' }}</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <form method="POST" action="{{ url_for('rate_lecture') }}">
                    <input type="hidden" name="session_id" value="{{ session[0] }}">
                    
                    <div class="rating-section">
                        <div class="mb-3">
                            <label class="form-label-cyber mb-3">LECTURE RATING</label>
                            <div class="rating-stars-cyber mb-3">
                                {% for i in range(1, 6) %}
                                <span class="star-cyber star-inactive" data-rating="{{ i }}" onclick="setRating(this, {{ session[0] }})">
                                    <i class="fas fa-star"></i>
                                </span>
                                {% endfor %}
                            </div>
                            <input type="hidden" name="rating" id="rating_{{ session[0] }}" required>
                            <div class="form-text text-terminal">Click stars to rate (1-5 stars)</div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="feedback_{{ session[0] }}" class="form-label-cyber">ADDITIONAL FEEDBACK</label>
                            <textarea class="feedback-input" id="feedback_{{ session[0] }}" name="feedback" rows="3" placeholder="Share your thoughts about this lecture... (optional)"></textarea>
                        </div>
                        
                        <button type="submit" class="btn btn-submit-rating">
                            <i class="fas fa-paper-plane me-2"></i> SUBMIT RATING
                        </button>
                    </div>
                </form>
            </div>
            {% endfor %}
        </div>
    </div>
    {% else %}
    <div class="ratings-card">
        <div class="card-body text-center">
            <div class="empty-state-rating">
                <div class="empty-icon-rating">
                    <i class="fas fa-check-circle"></i>
                </div>
                <h3 class="text-cyber mb-3">ALL CAUGHT UP!</h3>
                <p class="text-light mb-4">You have rated all available lectures. Check back after your next classes.</p>
                <a href="{{ url_for('student_dashboard') }}" class="btn btn-submit">
                    <i class="fas fa-arrow-left me-2"></i> BACK TO DASHBOARD
                </a>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<script>
function setRating(starElement, sessionId) {
    const rating = parseInt(starElement.getAttribute('data-rating'));
    const hiddenInput = document.getElementById('rating_' + sessionId);
    const stars = starElement.parentElement.querySelectorAll('.star-cyber');
    
    // Update hidden input
    hiddenInput.value = rating;
    
    // Update star display
    stars.forEach((star, index) => {
        const starIndex = parseInt(star.getAttribute('data-rating'));
        if (starIndex <= rating) {
            star.classList.remove('star-inactive');
            star.classList.add('star-active');
        } else {
            star.classList.remove('star-active');
            star.classList.add('star-inactive');
        }
    });
}

// Form validation
document.querySelectorAll('form').forEach(form => {
    form.addEventListener('submit', function(e) {
        const ratingInput = this.querySelector('input[name="rating"]');
        if (!ratingInput.value) {
            e.preventDefault();
            alert('Please select a rating before submitting.');
        }
    });
});

// Add hover effects to stars
document.querySelectorAll('.star-cyber').forEach(star => {
    star.addEventListener('mouseover', function() {
        const rating = parseInt(this.getAttribute('data-rating'));
        const stars = this.parentElement.querySelectorAll('.star-cyber');
        
        stars.forEach((s, index) => {
            const starRating = parseInt(s.getAttribute('data-rating'));
            if (starRating <= rating) {
                s.style.color = '#ffd700';
                s.style.transform = 'scale(1.1)';
            }
        });
    });
    
    star.addEventListener('mouseout', function() {
        const hiddenInput = this.parentElement.parentElement.querySelector('input[type="hidden"]');
        const currentRating = parseInt(hiddenInput.value) || 0;
        const stars = this.parentElement.querySelectorAll('.star-cyber');
        
        stars.forEach((s, index) => {
            const starRating = parseInt(s.getAttribute('data-rating'));
            s.style.transform = 'scale(1)';
            if (!currentRating || starRating > currentRating) {
                s.style.color = '';
            }
        });
    });
});
</script>
{% endblock %}